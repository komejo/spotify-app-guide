<html><head><title>Spotify App Guide - Playlists</title><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=lhDjYqiy3mZ0x6ROQEUoUw');ol{margin:0;padding:0}.c12{list-style-type:disc;margin:0;padding:0}.c14{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c1{font-size:8pt;background-color:#efefef;font-family:"Consolas"}.c3{text-indent:36pt;direction:ltr}.c0{direction:ltr;margin-left:36pt}.c13{color:inherit;text-decoration:inherit}.c2{height:11pt;direction:ltr}.c11{color:#1155cc;text-decoration:underline}.c10{font-weight:bold}.c9{padding-left:0pt}.c8{direction:ltr}.c7{height:11pt}.c4{background-color:#efefef}.c6{font-size:10pt}.c5{font-family:"Consolas"}.title{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:36pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}h2{padding-top:18pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h3{padding-top:14pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h4{padding-top:12pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:2pt}h5{padding-top:11pt;line-height:1.15;text-align:left;color:#666666;font-size:10pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}h6{padding-top:10pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:10pt;font-family:"Arial";padding-bottom:2pt}</style></head><body class="c14"><p class="c8"><span class="c10">Building a Spotify App - Playlists</span></p><p class="c8"><span>by Joe Komenda, </span><span class="c11"><a class="c13" href="http://asheavenue.com">Ashe Avenue</a></span></p><p class="c2"><span></span></p><p class="c8"><span class="c11"><a class="c13" href="http://www.spotify.com/us/">Spotify</a></span><span>&nbsp;is</span><span>&nbsp;a streaming music service with free ad-supported and paid models. Having previously worked at </span><span class="c11"><a class="c13" href="http://www.mergerecords.com/">Merge Records</a></span><span>, I can vouch for the service, as it actually pays royalties to the listed artists. After you download and install the client, you&rsquo;ll see that the service focuses heavily on user-created playlists. It encourages you to make and share playlists as well. </span></p><p class="c2"><span></span></p><p class="c8"><span>In late 2011, they launched the Spotify App API, allowing you to build your own app. The first set of apps were from Rolling Stone, Pitchfork, and other music sites. They also released a </span><span class="c11"><a class="c13" href="https://developer.spotify.com/technologies/apps/">development guide</a></span><span>, a minimally documented </span><span class="c11"><a class="c13" href="https://developer.spotify.com/technologies/apps/docs/beta/">API</a></span><span>&nbsp;(beta)</span><span>, and a </span><span class="c11"><a class="c13" href="http://www.google.com/url?q=https%3A%2F%2Fdeveloper.spotify.com%2Ftechnologies%2Fapps%2Ftutorial%2F&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHKVwRQTz7T0XfqwUer6w7JTxv9TQ">tutorial</a></span><span>. </span></p><p class="c2"><span></span></p><p class="c8"><span>The basic idea is this: the Spotify desktop client is Chromium-based, so Apps are single-browser websites that use Javascript to make API function calls and use JSON data to store information. &nbsp;If you get a developer account and go through the tutorial, you&rsquo;ll have a very basic app.</span></p><p class="c2"><span></span></p><p class="c8"><span>Of course, you&rsquo;ll probably want to have playlists, albums, and some kind of featured song in your app. The docs have little to say about that, but by hunting around on </span><span class="c11"><a class="c13" href="http://stackoverflow.com/questions/tagged/spotify">Stack Overflow</a></span><span>, you can piece things together. Since I&rsquo;ve already done that, I&rsquo;m going to share what I&rsquo;ve learned. </span></p><p class="c2"><span></span></p><p class="c8"><span>In the tutorial, you set up the following files:</span></p><ol class="c12" start="1"><li class="c0 c9"><span>manifest.json</span></li><li class="c0 c9"><span>index.html</span></li><li class="c0 c9"><span>tutorial.js (Personally, I&rsquo;d call this app.js)</span></li></ol><p class="c8"><span>You should also have an </span><span class="c6 c5">app.css</span><span>&nbsp;file for formatting. Bonus: since this is Chromium, you can use all the funky CSS3 you want. </span></p><p class="c2"><span></span></p><p class="c8"><span class="c10">Playlists</span></p><p class="c8"><span>To get a playlist (or lists) working, you start with a set of sample data, saved in a </span><span class="c6 c5">JSON</span><span>&nbsp;format. This </span><span class="c6 c5">app.json</span><span>&nbsp;file can be hosted anywhere, but you&rsquo;ll have to ensure the location is declared in the </span><span class="c6 c5">manifest.json</span><span>, as per the tutorial. For now, you can just keep it alongside the other files. </span></p><p class="c2"><span></span></p><p class="c8"><span>Here&rsquo;s an example of some playlist data:</span></p><p class="c0"><span class="c1">{ </span></p><p class="c0"><span class="c1">&nbsp; &quot;Playlists&quot; : [</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; { </span></p><p class="c3"><span class="c1">&nbsp; &nbsp; &nbsp; &quot;uri&quot; : &quot;spotify:user:keatshandwriting:playlist:21J20PgNUj49fSp2UOfawo&quot;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &quot;description&quot; : &quot;Lorem ipsum dolor sit amet, consectetur adipisicing...&quot;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; },</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; { </span></p><p class="c3"><span class="c1">&nbsp; &nbsp; &nbsp; &quot;uri&quot; : &quot;spotify:user:rachelnabors:playlist:1WKpZKvjVoIw1kt3ZqOut7&quot;,</span></p><p class="c3"><span class="c1">&nbsp; &nbsp; &nbsp; &quot;description&quot; : &quot;Excepteur sint occaecat cupidatat non proident, sunt...&quot;</span></p><p class="c3"><span class="c1">&nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; ]</span></p><p class="c0"><span class="c1">}</span></p><p class="c8"><span>Inside the &lsquo;Playlists&rsquo; data type, you can have as many sub-types as you want, but </span><span class="c4">uri</span><span>&nbsp;is the only one required to get the playlist working. &nbsp;</span></p><p class="c2"><span></span></p><p class="c8"><span>Now you should clean out all of the tutorial stuff, since you won&rsquo;t use it with a playlist. For example, the tutorial has you doing an onLoad in the body tag - however, we&rsquo;re going to use jQuery, as well as a bunch of API calls, so we&rsquo;ll add that to our cleaned up </span><span class="c5">index.html</span><span>:</span></p><p class="c0"><span class="c1">&lt;!DOCTYPE html&gt;</span></p><p class="c0"><span class="c1">&lt;html&gt;</span></p><p class="c0"><span class="c1">&lt;head&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;meta charset=&quot;utf-8&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;title&gt;MyApp&lt;/title&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;link rel=&quot;stylesheet&quot; href=&quot;sp://import/css/list.css&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;link rel=&quot;stylesheet&quot; href=&quot;sp://import/css/adam.css&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;link rel=&quot;stylesheet&quot; href=&quot;app.css&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;script src=&quot;jquery.js&quot;&gt;&lt;/script&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;script src=&quot;app.js&quot;&gt;&lt;/script&gt;</span></p><p class="c0"><span class="c1">&lt;/head&gt;</span></p><p class="c0"><span class="c1">&lt;body&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;h1 id=&quot;header&quot;&gt;My Playlists&lt;/h1&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;div id=&quot;playlist&quot;&gt;&lt;/div&gt; &lt;!-- this is the target div --&gt;</span></p><p class="c0"><span class="c1">&lt;/body&gt;</span></p><p class="c0"><span class="c1">&lt;/html&gt;</span></p><p class="c2"><span></span></p><p class="c8"><span>Next, clean up the </span><span class="c6 c5">app.js</span><span>&nbsp;to only have the following: </span></p><p class="c0"><span class="c1">var sp = getSpotifyApi(1),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; models = sp.require(&#39;sp://import/scripts/api/models&#39;),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; views = sp.require(&#39;sp://import/scripts/api/views&#39;),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; ui = sp.require(&#39;sp://import/scripts/ui&#39;),</span></p><p class="c3"><span class="c1">&nbsp; &nbsp; appData;</span></p><p class="c0 c7"><span class="c1"></span></p><p class="c0"><span class="c1">function init() {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; console.log(&quot;init()&quot;);</span></p><p class="c0"><span class="c1">}</span></p><p class="c0 c7"><span class="c1"></span></p><p class="c0"><span class="c1">$(document).ready(function(){</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; $.ajax({</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; url &nbsp; &nbsp; &nbsp;: &#39;app.json&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; dataType : &#39;json&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; type &nbsp; &nbsp; : &#39;POST&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; error &nbsp; &nbsp;: function(jqXHR, textStatus, errorThrown){</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.log(textStatus);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.log(errorThrown);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; success &nbsp;: function(data, textStatus, jqXHR) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; appData = data;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; init();</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; });</span></p><p class="c0"><span class="c1">});</span></p><p class="c0 c7"><span class="c1"></span></p><p class="c8"><span>By doing this, we get our </span><span class="c4 c6 c5">init();</span><span>&nbsp;call as well as our data from </span><span class="c5">app.json</span><span>. This makes calls to our datatypes as simple as calling </span><span class="c4 c6 c5">appData.Playlists</span><span>.</span><span>&nbsp;</span></p><p class="c2"><span></span></p><p class="c8"><span>As for the playlists, you need a function that contains a loop:</span></p><p class="c0"><span class="c1">function renderPlaylists() {</span></p><p class="c0"><span class="c1">&nbsp; for (i in appData.Playlists) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; // Get the data from the app.json Playlists and create vars</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; var playlist &nbsp; &nbsp;= models.Playlist.fromURI(appData.Playlists[i].uri),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; description = appData.Playlists[i].description,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; title &nbsp; &nbsp; &nbsp; = playlist.data.name,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; index &nbsp; &nbsp; &nbsp; = i,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; img &nbsp; &nbsp; &nbsp; &nbsp; = new ui.SPImage(playlist.data.cover),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; listView &nbsp; &nbsp;= new views.List(playlist, function(track) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return new views.Track(track, views.Track.FIELD.STAR | views.Track.FIELD.NAME);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; });</span></p><p class="c0 c7"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; // This inserts the html, with appropriately numbered classes and ids</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; $(&quot;#playlists&quot;).append(</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &#39;&lt;div id=&quot;playlist-&#39;+i+&#39;&quot; class=&quot;playlist&quot;&gt; \</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;playlist-info&quot;&gt; \</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;playlist-img-&#39;+i+&#39;&quot;&gt;&lt;a class=&quot;plink&quot; href=&quot;&#39;+playlist.uri+&#39;&quot;&gt;&lt;/a&gt;&lt;/div&gt; \</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h3&gt;&#39;+title+&#39;&lt;/h3&gt; \</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class=&quot;add-playlist button icon&quot; value=&quot;&#39;+playlist.uri+&#39;&quot;&gt; \</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class=&quot;plus&quot;&gt;&lt;/span&gt;Subscribe&lt;/button&gt; \</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p&gt;&#39;+description+&#39;&lt;/p&gt; \</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt; \</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt; \</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &lt;/div&gt;&#39;)</span></p><p class="c3"><span class="c1">&nbsp; &nbsp; &nbsp; // callback to insert Spotify img and track nodes</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; .each(function() {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; $(this).find(&#39;.playlist-img-&#39;+i+&#39; a&#39;).append(img.node).end()</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .find(&#39;#playlist-&#39;+i+&#39; .playlist-info&#39;).append(listView.node)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; });</span></p><p class="c0"><span class="c1">&nbsp; }</span></p><p class="c0 c7"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; // This makes the Subscribe button work. Does not need to be in the loop.</span></p><p class="c0"><span class="c1">&nbsp; $(&#39;.add-playlist&#39;).on(&#39;click&#39;, function() {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; var playlist = models.Playlist.fromURI($(this).attr(&#39;value&#39;));</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; playlist.subscribed = true;</span></p><p class="c0"><span class="c1">&nbsp; });</span></p><p class="c0"><span class="c1">}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c8"><span>Note: the </span><span class="c4 c6 c5">listView</span><span>&nbsp;var can also have the optional </span><span class="c4 c5 c6">views.Track.FIELD.DURATION |</span><span class="c6">&nbsp;</span><span>and </span><span class="c4 c6 c5">views.Track.FIELD.ARTIST |</span><span>&nbsp;- they were omitted it for code clarity. </span></p><p class="c2"><span></span></p><p class="c8"><span>Don&rsquo;t forget to add </span><span class="c4 c6 c5">renderPlaylists();</span><span>&nbsp;to the </span><span class="c4 c6 c5">init()</span><span>&nbsp;function! </span></p><p class="c0"><span class="c1">function init() {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; renderPlaylists(); // replaced the console.log() </span></p><p class="c0"><span class="c1">}</span></p><p class="c2"><span></span></p><p class="c8"><span>One last thing to get your app functionally compliant - the loading icon. Spotify did a good job documenting this. All you do is add this to the </span><span class="c4 c6 c5">.playlist</span><span>&nbsp;div in </span><span class="c6 c5">index.html:</span></p><p class="c3"><span class="c1">&lt;div class=&quot;loading&quot;&gt;</span></p><p class="c3"><span class="c1">&nbsp; &lt;div class=&quot;throbber&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;</span></p><p class="c3"><span class="c1">&lt;/div&gt;</span></p><p class="c2"><span></span></p><p class="c2"><span></span></p><p class="c8"><span>And add this to </span><span class="c6 c5">function init()</span><span>:</span></p><p class="c3"><span class="c1">var dom = sp.require(&#39;sp://import/scripts/dom&#39;);</span></p><p class="c3"><span class="c1">&nbsp; var loadingEl = dom.queryOne(&#39;.loading&#39;);</span></p><p class="c3"><span class="c1">&nbsp; dom.destroy(loadingEl);</span></p><p class="c8"><span>&nbsp;</span></p><p class="c8"><span>Now you&rsquo;ll have a spinner while the Spotify playlist is loading. </span></p><p class="c2"><span></span></p><p class="c8"><span>Now everything is working, but it&rsquo;s a mess. You can&rsquo;t even see the images! This is where you add the following to &nbsp;</span><span class="c6 c5">app.css</span><span>:</span></p><p class="c3"><span class="c1">a.plink, .image {</span></p><p class="c3"><span class="c1">&nbsp; background-size: cover;</span></p><p class="c0"><span class="c1">&nbsp; display: block;</span></p><p class="c0"><span class="c1">&nbsp; height: 75px;</span></p><p class="c0"><span class="c1">&nbsp; width: 75px;</span></p><p class="c0"><span class="c1">}</span></p><p class="c0 c7"><span class="c1"></span></p><p class="c8"><span>This formats the Spotify image nodes, which are rendered as divs that have Spotify-generated background images. &nbsp;</span></p><p class="c2"><span></span></p><p class="c8"><span>The anchor tags are there so that a click on the image takes you to the native Spotify playlist page, as per the Spotify </span><span class="c11"><a class="c13" href="https://developer.spotify.com/technologies/apps/guidelines/02_app-design-guidelines.html">App Design Guidelines</a></span><span>. Now would be a good time to read those, so you can get started making your app pretty. </span></p><p class="c2"><span></span></p><p class="c8"><span>Good luck, and if you see any errors, typos or omissions, please let me know. </span></p><p class="c2"><span></span></p><p class="c8"><span>Joe Komenda</span></p><p class="c8"><span>jkomenda@asheavenue.com</span></p><p class="c2"><span></span></p><p class="c2"><span></span></p><p class="c2"><span></span></p></body></html>