<html><head><title>Spotify Ap Guide - Albums</title><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=lhDjYqiy3mZ0x6ROQEUoUw');ol{margin:0;padding:0}.c1{height:11pt;direction:ltr;margin-left:18pt}.c4{font-size:8pt;background-color:#efefef;font-family:"Consolas"}.c14{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c7{color:inherit;text-decoration:inherit}.c0{font-size:10pt;font-family:"Consolas"}.c9{color:#1155cc;text-decoration:underline}.c2{text-indent:18pt;direction:ltr}.c3{direction:ltr}.c8{height:11pt}.c6{margin-left:18pt}.c10{font-weight:bold}.c11{background-color:#efefef}.c12{font-style:italic}.c13{font-size:10pt}.c5{margin-left:36pt}.title{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:36pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}h2{padding-top:18pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h3{padding-top:14pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h4{padding-top:12pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:2pt}h5{padding-top:11pt;line-height:1.15;text-align:left;color:#666666;font-size:10pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}h6{padding-top:10pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:10pt;font-family:"Arial";padding-bottom:2pt}</style></head><body class="c14"><p class="c3"><span class="c10">Building a Spotify App - Albums</span></p><p class="c3"><span>by Joe Komenda,</span><span><a class="c7" href="http://asheavenue.com/">&nbsp;</a></span><span class="c9"><a class="c7" href="http://asheavenue.com/">Ashe Avenue</a></span></p><p class="c3 c8"><span></span></p><p class="c3"><span>Now that we&rsquo;ve got a working Spotify App and playlists working, lets move on to something more complex - albums. Just as a reminder, you access your Spotify app searching for </span><span class="c0">spotify:app:myapp </span><span>For the purpose of this demo, I&rsquo;ve copied the playlist demo (</span><span class="c0">myapp</span><span>) and renamed it </span><span class="c0">myapp-albums.</span></p><p class="c3 c8"><span class="c0"></span></p><p class="c3"><span>Before we go further, our app is pretty ugly, so let&rsquo;s concede that some basic styling took place after we got the playlists working. This is what I added to </span><span class="c0 c11">app.css</span><span>:</span></p><p class="c3 c5"><span class="c4">h1 { font-size: 2.2em;font-weight: bold;margin: 10px; }</span></p><p class="c3 c5"><span class="c4">p, .button, h3 { margin: 0 0 10px 0; }</span></p><p class="c3 c5"><span class="c4">#playlists { margin: 10px; }</span></p><p class="c3 c5"><span class="c4">.playlist {background: #333;border: 1px solid #666;border-radius: 10px;</span></p><p class="c3 c5"><span class="c4">&nbsp; float: left;padding: 10px;margin: 10px;width: 300px; }</span></p><p class="c3 c5"><span class="c4">#playlists h3 { font-size: 1.2em;font-weight: bold; }</span></p><p class="c3 c5"><span class="c4">#playlists .plink { float: left;padding: 0 10px 10px 0; }</span></p><p class="c3 c8"><span class="c0"></span></p><p class="c3"><span>Note: Condensed for readability. Don&rsquo;t format CSS this way.</span></p><p class="c3 c8"><span></span></p><p class="c3"><span class="c10">Albums</span></p><p class="c3 c8"><span></span></p><p class="c3"><span>Let&rsquo;s begin by finding a couple of our favorite albums and adding them to our </span><span class="c0">app.json</span><span>. You can find albums by searching for and selecting an artist, and at will list their albums, with covers. Right-click on the cover art and &lsquo;Copy Spotify URI&rsquo;. Paste the URI into the new Albums section of app.json:</span></p><p class="c3 c5"><span class="c4">&quot;Albums&quot; : [</span></p><p class="c3 c5"><span class="c4">&nbsp; {</span></p><p class="c3 c5"><span class="c4">&nbsp; &nbsp; &quot;uri&quot; : &quot;spotify:album:0eW4vkDVxqS4U60ExzsKhR&quot;,</span></p><p class="c3 c5"><span class="c4">&nbsp; &nbsp; &quot;description&quot; : &quot;Duis aute irure dolor in reprehenderit in voluptate velit...&quot;</span></p><p class="c3 c5"><span class="c4">&nbsp; },</span></p><p class="c3 c5"><span class="c4">&nbsp; {</span></p><p class="c3 c5"><span class="c4">&nbsp; &nbsp; &quot;uri&quot; : &quot;spotify:album:0lNXyDxuSSt7BY5SgNJefb&quot;,</span></p><p class="c3 c5"><span class="c4">&nbsp; &nbsp; &quot;description&quot; : &quot;Ut enim ad minim veniam, quis nostrud exercitation ullamco...&quot;</span></p><p class="c3 c5"><span class="c4">&nbsp; }</span></p><p class="c3 c5"><span class="c4">]</span></p><p class="c3 c8"><span></span></p><p class="c3"><span>Be sure you separate it from the </span><span class="c0">Playlists[ ] </span><span>data with a comma. If you reload your app, it should still load the playlists. <br></span></p><p class="c3"><span>Now we&rsquo;ll copy the placeholder HTML from </span><span class="c0">index.html</span><span>, and rename the id and loader class:</span></p><p class="c3"><span>&nbsp; &nbsp; </span><span class="c4">&lt;div id=&quot;albums&quot;&gt;</span></p><p class="c3"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;loading2&quot;&gt;</span></p><p class="c3"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;throbber&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;</span></p><p class="c3"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c3"><span class="c4">&nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c3 c8"><span></span></p><p class="c3"><span>I put this on top of the playlists block, so that it is at the top of the page when reloading.</span></p><p class="c3"><span>Now for the </span><span class="c0">renderAlbums()</span><span>&nbsp;function:</span></p><p class="c3 c6"><span class="c4">function renderAlbums() {</span></p><p class="c3 c6"><span class="c4">&nbsp; for (var i in appData.Albums) { &nbsp;// loop through the Albums</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; // The two nested functions below are needed to make a closure</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; function makeFunc(i) {</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; function displayAlbum(i) {</span></p><p class="c2 c8"><span class="c4"></span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; // Get all of the data and set vars</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; models.Album.fromURI(appData.Albums[i].uri, function(album) {</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var artist = album.artist.name,</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cover = album.data.cover,</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; description = appData.Albums[i].description,</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; index = i,</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; title = album.name,</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; allTracks = (album.tracks);</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Creates a new (temp) playlist based on the tracks</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var pl = new models.Playlist();</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pl.add(allTracks);</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Creates a formatted, playable list, based on the (temp) playlist</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var listView = new views.List(pl, function(allTracks) {</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return new views.Track(allTracks, views.Track.FIELD.STAR | views.Track.FIELD.NAME);</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; })</span></p><p class="c1"><span class="c4"></span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Now we render the HTML</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(&quot;#albums&quot;).append(</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;&lt;div id=&quot;album-&#39;+i+&#39;&quot; class=&quot;album&quot;&gt; \</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;album-info&quot;&gt; \</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;album-img-&#39;+i+&#39;&quot;&gt;&lt;a class=&quot;plink&quot; href=&quot;&#39;+album.uri+&#39;&quot;&gt;&lt;/a&gt;&lt;/div&gt; \</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3&gt;&#39;+title+&#39;&lt;/h3&gt; \</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button class=&quot;add-playlist button icon&quot; value=&quot;&#39;+album.uri+&#39;&quot;&gt; \</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span class=&quot;plus&quot;&gt;&lt;/span&gt;Subscribe&lt;/button&gt; \</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p&gt;&#39;+description+&#39;&lt;/p&gt; \</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt; \</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;&#39;)</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.each(function() {</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$(this).find(&#39;.album-img-&#39;+i+&#39; a&#39;)</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.append(&#39;&lt;div class=&quot;image&quot; style=&quot;background-image:url(&#39;+cover+&#39;);&quot;&gt;&lt;/div&gt;&#39;).end()</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.find(&#39;#album-&#39;+i+&#39; .album-info&#39;).append(listView.node);</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});</span></p><p class="c1"><span class="c4"></span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Make &#39;Subscribe&#39; work with an album, and set a name so it&#39;s not temporary.</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$(&#39;#album-&#39;+i+&#39; .add-playlist&#39;).on(&#39;click&#39;, function() {</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var MyPlaylist = new models.Playlist(album.name + &quot; by &quot; + album.artist.name);</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$.each(album.tracks,function(i,track){</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MyPlaylist.add(track)</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MyPlaylist.subscribed = true;</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; return displayAlbum;</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; }</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; var myFunc = makeFunc();</span></p><p class="c3 c6"><span class="c4">&nbsp; &nbsp; myFunc(i);</span></p><p class="c3 c6"><span class="c4">&nbsp; }</span></p><p class="c3 c6"><span class="c4">}</span></p><p class="c1"><span class="c4"></span></p><p class="c3"><span>It looks kind of intimidating, but don&rsquo;t worry, it&rsquo;s really just </span><span class="c0">renderPlaylists() </span><span>with some extra nesting. </span></p><p class="c3 c8"><span></span></p><p class="c3"><span>The most noticeable thing about this function vs </span><span class="c0">renderPlaylists()</span><span>&nbsp;is the extra nested functions, </span><span class="c0 c11">makeFunc()</span><span class="c13">&nbsp;</span><span>and </span><span class="c0 c11">displayAlbum()</span><span>&nbsp;and the </span><span class="c0 c11">myFunc()</span><span>&nbsp;that calls them. This is a </span><span class="c12">closure</span><span>, and is needed because each album and all of its data must pulled in before we can generate a playlist. Since Spotify does everything asynchronously, you must use closures for all non-playlist data. </span></p><p class="c3 c8"><span></span></p><p class="c3"><span>That&rsquo;s the funny thing about albums in Spotify - they don&rsquo;t have playlists associated with them. You have the build a </span><span class="c0">new models.Playlist()</span><span>&nbsp;and add all of the album&rsquo;s tracks for each album, every time you call it. In fact, you have to use closures and build playlists for ALL non-playlist data. That&rsquo;s why I used Playlists as an introduction - they&rsquo;re relatively simple. &nbsp;</span></p><p class="c3 c8"><span></span></p><p class="c3"><span>In addition, to subscribe to an album, we have to build the jQuery calls to </span><span class="c0">.add-playlist</span><span>&nbsp;elements inside the closure (since you can&rsquo;t get album data otherwise), and create a name for the new playlist so it isn&rsquo;t temporary. </span></p><p class="c3 c8"><span></span></p><p class="c3"><span>Since we aren&rsquo;t calling </span><span class="c0">playlist.image</span><span>, there&rsquo;s no node rendering (That is, Spotify does not build the HTML for you), so you have to </span><span class="c0">append()</span><span>&nbsp;a div with the album image as an inline style using </span><span class="c0 c11">&lt;div class=&quot;image&quot; style=&quot;background-image:url(&#39;+cover+&#39;);&quot;&gt;&lt;/div&gt;</span></p><p class="c3 c8"><span class="c13"></span></p><p class="c3"><span>Then you add </span><span class="c0">renderAlbums() </span><span>to</span><span class="c0">&nbsp;init()</span><span>&nbsp;in addition to the second &lsquo;loading&rsquo; spinner: </span></p><p class="c3 c5"><span class="c4">function init() {</span></p><p class="c3 c5"><span class="c4">&nbsp; &nbsp; renderPlaylists();</span></p><p class="c3 c5"><span class="c4">&nbsp; &nbsp; renderAlbums();</span></p><p class="c3 c5"><span class="c4">&nbsp; &nbsp; var dom = sp.require(&#39;sp://import/scripts/dom&#39;);</span></p><p class="c3 c5"><span class="c4">&nbsp; &nbsp; var loadingEl = dom.queryOne(&#39;.loading&#39;);</span></p><p class="c3 c5"><span class="c4">&nbsp; &nbsp; dom.destroy(loadingEl);</span></p><p class="c3 c5"><span class="c4">&nbsp; &nbsp; var loadingEl2 = dom.queryOne(&#39;.loading2&#39;);</span></p><p class="c3 c5"><span class="c4">&nbsp; &nbsp; dom.destroy(loadingEl2);</span></p><p class="c3 c5"><span class="c4">}</span></p><p class="c3 c8 c5"><span class="c4"></span></p><p class="c3"><span>Then you just add </span><span class="c0">#albums</span><span>&nbsp;and </span><span class="c0">.album</span><span>&nbsp;to the </span><span class="c0">app.css</span><span>&nbsp;and it&rsquo;s looking great. </span></p><p class="c3 c8"><span></span></p><p class="c3"><span>Joe Komenda</span></p><p class="c3"><span>Ashe Avenue</span></p></body></html>